To enable external agents, regenerate configmap of api-service:

Example:
```yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: klovercloud-api-service-envar-config
  namespace: klovercloud
data:
  RUN_MODE: "PRODUCTION"
  SERVER_PORT: "8080"
  KLOVERCLOUD_CI_INTEGRATION_MANAGER_URL: "http://klovercloud-integration-manager.klovercloud.svc.cluster.local/api/v1"
  KLOVERCLOUD_CI_EVENT_STORE: "http://klovercloud-ci-event-bank.klovercloud.svc.cluster.local/api/v1"
  KLOVERCLOUD_CI_EVENT_STORE_WS: "ws://klovercloud-ci-event-bank.klovercloud.svc.cluster.local/api/v1"

  PUBLIC_KEY: "-----BEGIN RSA PUBLIC KEY-----\nMIICCgKCAgEA1t9z/Ev9r8LwVVuwd34S0+5i8ngfwVivpZM4TJgyiHW85g5kPoxz\nXPu3XE6OBvclYsAK1Ue0k6ANO04UG/cgSm7PagQyb0Jjw+II4EnshzHeXsLn3ETt\nTZC3LmT3C8MztJhhux+kldvdKJAl9PH7Ltf0CqQ9KYxqa3HZUaBZk99IE9OVekPM\n2xYl+UPolf/E+4UXE4YKSUl6JcZf2nRZYVJGIZSEK9hIwhFotDHELryZSF0S8kJq\nHFlN3AYa8noMZCGO/hM5+SS4MFwCSlMxhcpLdprxVCDotqQnGM0qqX2+y7MtFU9Z\nCEa8BiD+zeBRhzMZCZb1yyraxGQYm26Tagl+eR2NQQPmnhlvKpZn0QjaPznYVmf/\ngSXr9XufJ5q4fcSScGX+y9Es6g1i6jf3559gSgQy3TvaY12Yq0ROf/CJjChJzoyP\nIW3isitC+78vSRmmPB5//6AQjq6Tlqw5/CUDZYqjAvEojvwR3hjlunOSWqvIXPFe\nHXoHs2WNYUrWxtUBy9ABPw+1QOBxwQ7C7MG0XaA/gvV0+hf5SDfwndQ8tob+/eiM\nMJPGQ7Ex/fA6Sro3EQOoR0KrJeaPRdI223gJq0CZ9pZMTPA11dK1KZwoYeBjMbgE\nDNkNIaww49rzr4VJS+g5nBCyQIoulR5mJRyV9C+AU/FNy1OYlOJE7QkCAwEAAQ==\n-----END RSA PUBLIC KEY-----\n"

  ENABLE_AUTHENTICATION: "true"
  JAEGER_AGENT_HOST: "localhost"
  JAEGER_SAMPLER_TYPE: "const"
  JAEGER_SAMPLER_PARAM: "1"
  JAEGER_REPORTER_LOG_SPANS: "true"
  JAEGER_SERVICE_NAME: "api-service"
  ENABLE_OPENTRACING: "true"
  PRIVATE_KEY_FOR_INTERNAL_CALL: "-----BEGIN RSA PRIVATE KEY-----\n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\n-----END RSA PRIVATE KEY-----\n"
  PUBLIC_KEY_FOR_INTERNAL_CALL: "-----BEGIN RSA PUBLIC KEY-----\nMIICCgKCAgEA1t9z/Ev9r8LwVVuwd34S0+5i8ngfwVivpZM4TJgyiHW85g5kPoxz\nXPu3XE6OBvclYsAK1Ue0k6ANO04UG/cgSm7PagQyb0Jjw+II4EnshzHeXsLn3ETt\nTZC3LmT3C8MztJhhux+kldvdKJAl9PH7Ltf0CqQ9KYxqa3HZUaBZk99IE9OVekPM\n2xYl+UPolf/E+4UXE4YKSUl6JcZf2nRZYVJGIZSEK9hIwhFotDHELryZSF0S8kJq\nHFlN3AYa8noMZCGO/hM5+SS4MFwCSlMxhcpLdprxVCDotqQnGM0qqX2+y7MtFU9Z\nCEa8BiD+zeBRhzMZCZb1yyraxGQYm26Tagl+eR2NQQPmnhlvKpZn0QjaPznYVmf/\ngSXr9XufJ5q4fcSScGX+y9Es6g1i6jf3559gSgQy3TvaY12Yq0ROf/CJjChJzoyP\nIW3isitC+78vSRmmPB5//6AQjq6Tlqw5/CUDZYqjAvEojvwR3hjlunOSWqvIXPFe\nHXoHs2WNYUrWxtUBy9ABPw+1QOBxwQ7C7MG0XaA/gvV0+hf5SDfwndQ8tob+/eiM\nMJPGQ7Ex/fA6Sro3EQOoR0KrJeaPRdI223gJq0CZ9pZMTPA11dK1KZwoYeBjMbgE\nDNkNIaww49rzr4VJS+g5nBCyQIoulR5mJRyV9C+AU/FNy1OYlOJE7QkCAwEAAQ==\n-----END RSA PUBLIC KEY-----\n"
```
To apply the configmap, run:
```
kubectl apply -f configmap.yaml
```
To restart the deployment, run:
```
kubectl rollout restart deployment/{deployment-name_of_api_service}
```
To execute the deployment, run:
```
kubectl exec -it {api service pod} -n {namespace_of_api_service} bash
```
To generate agent token, run:
```
kcpctl generate-jwt client={your agent name}
```
It will return a token, which you can use to authenticate with the API.
Example:
```
root@klovercloud-api-service-59b65595cf-n6qdx:/app# kcpctl generate-jwt client=local_agent 

token:  eyJhbGciOiJSUzUxMiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjp7Im5hbWUiOiJsb2NhbCJ9LCJleHAiOjUyNTI1MjU4NDAsImlhdCI6MTY1MjUyNTg0MH0.iK2TuESPqeL8SAcnNN-BD_Iy3tLfEFybDW6YDpyvtlQsI5or8cMot_bUmI1iQMkM3Kag5pJ2RHm06w0qgAeLDY8KUGk7mIAWlo41Grdls8vTkyIoVeyE-LYR4tYefqoaP36eTs2tiumZyFmQ8htlWaLUUnUibqumfixu_4rqyxJvaRfTdDitd5dfQ_dqpsmgv18-EA4E1IygFsiqO3ju6PHHETPL41bhioUCBNIuJjt04g2cBQpIKU5ean75YbFRM5QAnlpQQXE-urmiT1_z0nSd_Diz10RLhSZqMaw9Ft1gLl3hkUkKfKifSWokOE9yNrt1j6NM0qwEfFwKwYGEF8DXTBiVmgCEP06DZKcTxj9I_edku2NzhRiOAtYh4zqN_i9VkeMndJGDRm8p29z9qjAr-0HsKetf0s4VwtypaqxGOd1d3wOJpsluEH7MmQMXgu-jmzdQk0yZUd8O3LmAUDsDg8Th6zBFY9U8QebZxQrlz-eiVJvXZqKjmcj2iuIjEod2MPcDGvfDM2wdh5QaABRuMSfIkX-82AZTEVcPjZAgtAeIZXToLxxdNWUqEzgOH0RNCt7c1-LVZ__9CPhz1Q3mXbDzrJ66t76KLQPk8c7gJtiqrj0iU74-dzO0Q9_mGNIsL1jhi6zuXRmywc8ka_D7FswiVbFCZYWd47yJ0vk

root@klovercloud-api-service-59b65595cf-n6qdx:/app#
```
Copy the token and regenerate the configmap of agent.
Example:
```yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: klovercloud-ci-agent-envar-config
  namespace: klovercloud
data:
  IS_K8: "True"
  RUN_MODE: "PRODUCTION"
  SERVER_PORT: "8080"
  EVENT_STORE_URL: "http://klovercloud-ci-event-bank/api/v1"
  AGENT_NAME: "local_agent"
  PULL_SIZE: "4"
  PUBLIC_KEY: "-----BEGIN RSA PUBLIC KEY-----\nMIICCgKCAgEA1t9z/Ev9r8LwVVuwd34S0+5i8ngfwVivpZM4TJgyiHW85g5kPoxz\nXPu3XE6OBvclYsAK1Ue0k6ANO04UG/cgSm7PagQyb0Jjw+II4EnshzHeXsLn3ETt\nTZC3LmT3C8MztJhhux+kldvdKJAl9PH7Ltf0CqQ9KYxqa3HZUaBZk99IE9OVekPM\n2xYl+UPolf/E+4UXE4YKSUl6JcZf2nRZYVJGIZSEK9hIwhFotDHELryZSF0S8kJq\nHFlN3AYa8noMZCGO/hM5+SS4MFwCSlMxhcpLdprxVCDotqQnGM0qqX2+y7MtFU9Z\nCEa8BiD+zeBRhzMZCZb1yyraxGQYm26Tagl+eR2NQQPmnhlvKpZn0QjaPznYVmf/\ngSXr9XufJ5q4fcSScGX+y9Es6g1i6jf3559gSgQy3TvaY12Yq0ROf/CJjChJzoyP\nIW3isitC+78vSRmmPB5//6AQjq6Tlqw5/CUDZYqjAvEojvwR3hjlunOSWqvIXPFe\nHXoHs2WNYUrWxtUBy9ABPw+1QOBxwQ7C7MG0XaA/gvV0+hf5SDfwndQ8tob+/eiM\nMJPGQ7Ex/fA6Sro3EQOoR0KrJeaPRdI223gJq0CZ9pZMTPA11dK1KZwoYeBjMbgE\nDNkNIaww49rzr4VJS+g5nBCyQIoulR5mJRyV9C+AU/FNy1OYlOJE7QkCAwEAAQ==\n-----END RSA PUBLIC KEY-----\n"
  TOKEN: "eyJhbGciOiJSUzUxMiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjpudWxsLCJleHAiOjEwMCwiaWF0IjoxNjM1MDM5NTYwfQ.fY4dYVyIk_q_g6aIGmqQBrNO8CPOrSuuWnqbVbUViYh1UHb_sDTKMJnlBRiBhwoDJC-eCFIyuKvQ3NpiMaXMDiUd4W13l1czQnkF3IJls9id0KIDN3jnWMNyFCTWGbLUtLQEbS43qjX2HrUmJroRElWc6xX8bVMYPj8k7_KLrJImJjx_bo03nCzHU1xn741c-pzXcZ2jOqwKXAqKfXj15h-_bXyYWQcu5IATe9LONfZ_XFy-kqGrdUlKLNAT6ufJPJv-q60ZkqV_7xPEidgIllELZsKyHGF8k47_r9KRbsWeTMD4VUyB-BfkMRMFJ54p4cSSWX1MQj5KnwuUFQX029dyYpFMGCEKe20phQx8oYlMIDkfn4-EOx2Auu8cE71-TjMhPZgmUchZy_6x3L1PMEAjOOttE30UFiVII5LVrOkyEDj8VaZMwKnQ9ErtjER6Vk0-RqDgO6caYeIFPuq9XJ6WL33PTtc3UB1ohxP65c9CC5aGRnVPGsCtnpz9oWoLjZVeKesTy05V3ANe_4gPaQ_t_8Z8o5TbWWU3mUoQXUGM10n5vFMfvzyMm8qnxv7SqYcejuR4zvCGxPcBZHZz2FBUTrQ8f8laUmHf4j5o_Oz43oF3uZQxRpN0B-S0YlW0wEoPrc4n8v2ZgF-l7a33_7Wu6KjPueeTl1qnci5g_gc"
  ENABLE_AUTHENTICATION: "true"
```
To apply the configmap, run the following command:
```
kubectl apply -f klovercloud-ci-agent-envar-config.yaml
```
To restart the agent, run the following command:
```
kubectl rollout restart deployment/{deployment_name_of_agent} -n {namespace_of_agent}
```
